
## 1. **eDesign** **HLD自动设计支持的网络结构**

目前，eDesign支持树形的网络结构，即以下网络结构：
![HLD 自动设计.png - Droplr](https://d.pr/i/eytorc+)
![](file:////private/var/folders/64/y7wsv9dn5ml03r9pcj_7rnkh0000gn/T/com.kingsoft.wpsoffice.mac/wps-adir/ksohtml//wps1.jpg) 

类似图示，即上级网络资源到下级网络资源，是一个一对多的对应情况，且上级到下级之间是单独的路由（即树形，不支持串行结构，即一个上级串行多个下级设备）。

不支持上级和下级资源同处于一个设备中（比如L2分光器和L1分光器处于同一个接头之中）。

只支持全新建网络，不支持利旧现有网络。

## 2. **特殊名称解释**

### 2.1 **网络数据**

网络数据是一种存储具有网络拓扑关系的数据模型。网络数据模型包含了网络线数据和网络结点数据，还包含了两者之间的拓扑关系。基于网络数据模型，可以进行路径分析、服务区分析、最近设施查找、选址分区、通达性分析等多种网络分析。这也是我们自动HLD算法的基础。

网络数据可以由多个线数据构成，这里的线数据在业务上一般包括：

l 道路数据

l 管道数据

l 杆路数据

### 2.2 **备选点**

在进行设备放置算法的时候，提供给算法作为放置的备选位置的数据。在GIS上以点数据作为存储。

在业务上，一般包括：

l人井

l 电杆

### 2.3 **损耗**

这是一个业务概念，主要是描述线对象在网络建设过程中的施工消耗工作量和价格。在实际算法中，用此概念来进行判断路径的优劣。

体现在算法中，损耗可以由以下参数结合：

l 长度：这是最基本的参数，越长的路径说明损耗越高。

l 权重：这是其余施工相关的参数按照经验进行的一个调整参数，默认为1，可以根据道路的施工难度等情况，来进行调整，比如说，主干道施工难度大，权重可以调整为1.2，则100米的长度最终损耗为100x1.2 = 120。加入次干道的权重为1，则说明相同100米长度的光缆铺设，在次干道上铺设比在主干道上铺设更优。

## 3. **必须的数据**

### 3.1 **建筑物**

必须需要有以面对象为存储形式的建筑物数据，建筑物数据中必须包含如下属性：

user_qty:用来表示当前建筑物的用户数量

### 3.2 **网络数据**

参考特殊名词说明。HLD自动设计依赖于网络，网络可以由多个数据构建而成。

## 4. **支持的HLD自动设计算法**

### 4.1 **沿道路自动布点**

一、算法说明

在功能上，即网格内沿着某个线图层定长增加点对象。

在业务上，即符合具体的基础设施的铺设原则，即沿着道路铺设人井，电杆，都是一般采取定长间隔的方式。

在HLD自动设计层面，此功能不是一个必须项，而是当基础数据中没有备选点图层时，快速的生成备选点的一个步骤。

二、算法参数

放置点图层：即布点放置的资源，一般为人井/电杆。

间隔距离：布放点资源的间隔。单位米。

额外长度处理方式：当前线的长度按照给定间隔距离划分之后的额外长度的处理方式，包括：

l 平均：根据给定距离定长布点；

l 合并：最后一段大于给定点间隔；

l 固定：最后一段小于给定点间隔

不包含的道路级别：道路包含很多子类型配置，比如主干道，次干道，乡道等。这里可以选择某些类型的道路不参与进行自动布点。

三、算法结果

### 4.2 **自动建筑物聚类****+****接入设备选址****+****自动连线**

一、算法说明

在功能上，即一定范围内建筑物按照一定的规则进行聚类，汇聚成一个网格。并在网格内的备选点内，找一个最优点，使得这个点到网格内的建筑物的路径的损耗最优，并添加这些路径。

在业务上，即符合从下往上的设计原则的前提下，按照接入设备的覆盖用户数要求，对整个设计区域内的建筑物进行ODB网格的划分。同时在划分好的ODB网格内，选一个最优的位置进行ODB的放置。并将ODB和这些建筑物进行光缆入户。

二、算法参数

放置点图层：即布点放置的资源，一般为人井/电杆。

汇聚图层：最终用什么网格来进行汇聚，这里一般选择ODB网格。

入户光缆最长距离：允许的入户光缆的最长距离，一般是100米。

容限字段：用来统计汇聚建筑物的字段，一般为user_qty，表示使用用户数来进行汇聚。

最大汇聚容量：表示汇聚的容限字段的和的最大值，比如说，一个ODB最多覆盖8户，则这个值填8.

上级点资源图层：指汇聚点放置的资源类型，一般为ODB或者F_CLOSURE。

线资源图层：指连接上级点图层和建筑物之间的线对象的图层，一般是光缆。

三、算法结果

### 4.3 **自动下级网格聚类****+****接入设备选址****+****自动连线**

一、算法说明

在功能上，即一定范围内下级网格按照一定的规则进行聚类，汇聚成一个上级网格。并在网格内的备选点内，找一个最优点，使得这个点到下级网格内的汇聚点的路径的损耗最优，并添加这些路径。

在业务上，即符合从下往上的设计原则的前提下，按照下级的覆盖用户数要求，对整个设计区域内的下级网格进行上级网格的划分（比如从ODB网格汇聚到OCC网格）。同时在划分好的上级网格内，选一个最优的位置进行上级设备的放置。并将上级设备（比如OCC）和这些下级设备进行光缆连接。

二、算法参数

放置点图层：即布点放置的资源，一般为人井/电杆。

汇聚图层：最终用什么网格来进行汇聚，这里一般选择OCC网格。

光缆最长距离：允许的光缆的最长距离，一般是1500米。

容限字段：用来统计汇聚的字段，一般为user_qty，表示使用用户数来进行汇聚。下级设备上也有这个字段表示下级设备已经汇聚了多少用户。

最大汇聚容量：表示汇聚的容限字段的和的最大值，比如说，一个OCC最多连接10个ODB，每个ODB最多覆盖8户，则一个OCC最多覆盖80户。

上级点资源图层：指汇聚点放置的资源类型。

线资源图层：指连接上级点图层和下级点图层之间的线对象的图层，一般是光缆。

三、算法结果

### 4.4 **网格内上级资源到下级资源的自动连线**

一、算法说明

在功能上，即一定范围内的上级点到下级点之间，添加损耗最优的路径。

在业务上，即当OCC已经汇聚完成后，从OLT到OCC之间最优连线（OLT一般客户给出，已经知道）。

二、算法参数

上级点图层：一般为OLT/CO。

下级点图层：比如OCC。

三、算法结果

## 5. **总体流程**

上面都是分散的单独的HLD设计功能，在一次完整的GreenField网络新建过程中，假设采取2级分光，一级分光在OCC中，二级分光在ODB中，则操作顺序如下：

1. 根据基础数据，构建网络。

2. 根据数据，判断是否有人井等备选点数据，如果没有，则采用沿道路自动布点来进行基础设施放置。

3. 工勘获得建筑物的用户数信息

4. 使用自动建筑物聚类+接入设备选址+自动连线算法，自动将建筑物按照用户数要求汇聚为ODB网格，同时在最优点放置ODB，同时对ODB和所有的覆盖的建筑物进行光缆连接。

5. 使用自动下级网格聚类+接入设备选址+自动连线算法，自动将ODB网格汇聚为OCC网格，同时在OCC网格内找最优点放置OCC，同时对OCC和覆盖的ODB网格内的ODB进行光缆连接。

6. 使用网格内上级资源到下级资源的自动连线算法，对OLT（已经指定）和所有的OCC进行光缆自动连线。

这样，就构建出了HLD设计。